<!-- top navbar -->
<div class="row">
  <div class="container-fluidf NavbarTwoTop">
    <div class="container">
      <div class="col-sm-12">
        <h3>Find Deals for Any Season</h3>
        <h5>From cozy country homes to funky city apartments</h5>
      </div>
    </div>
  </div>
  <nav class="navbar navbar-default NavbarTwo" id="NavbarTwo" style="background:red">
    <div class="container">
      <ul class="nav navbar-nav NavbarStyle" >
        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-3 FontSize">
          <div class="form">
            <div class="input-group ">
            <span class="input-group-addon EdgesSharp"><i id="DestinationSymbol" class="glyphicon glyphicon-map-marker"></i></span>
            <input id="Destination" type="text" class="form-control EdgesSharp input-lg FontForInput" placeholder="Destination" name = 'city'>
            </div>
          </div>
        </li>
        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-4 FontSize">
          <div class="form">
            <div class="input-group">
              <span class="input-group-addon EdgesSharp"><i class="glyphicon glyphicon-calendar"></i></span>
              <input class="form-control EdgesSharp input-lg FontForInput" id="Calendar"type="text" name="datefilter" value="" onkeydown="return false" placeholder="Check-In - Check-Out" name = 'daterange'/>
            </div>
          </div>
        </li>
        <div class="hidden-xs hidden-lg" style="padding-top: 20px">&nbsp</div>
        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-3">
          <div style="display: flex;">
            <div class="col-xs-2" style="height:45px;max-width:39px;border: solid 1px #CCCCCC; border-right:none;background-color:#EEEEEE">
             <i class="fa fa-bed"style="position:absolute;left:5px;font-size:22px;top: 10px;color: #545253;"></i>
             </div>
            <input id="RACShow" onkeydown="return false" type="text" class="col-xs-10 form-control EdgesSharp" style="height:45px;" placeholder="Rooms:0 Adults:0 Child:0">
          </div>
          <div class="drpdwn drpdwnhe" style="display:none">
            <div class="col-sm-12" style="background:white">
              <div class="row" id="TotalRoom" style="padding-left:5px;padding-right:5px">
              </div>
              <div class="row" style="padding-left:5px;padding-right:5px">
                <div class="row">
                  <div class="col-sm-12">
                    <h5>
                      Room Details
                    </h5>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-8">
                    Adults
                  </div>
                  <div class="col-sm-4">
                    <select class="form-control control-label input-sm EdgesSharp" id="NoOfAdult">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </div>
                </div>
                <div class="row" style="padding-top:10px;padding-bottom:10px;">
                  <div class="col-sm-8">
                    Children
                  </div>
                  <div class="col-sm-4">
                    <select class="form-control control-label input-sm EdgesSharp" id="NoOfChild">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </div>
                </div>
                <div class="row" style="padding-bottom:5px;" id="ChildAgeCol">
                </div>
              </div>
              <div class="row" style="border-top:solid 1px #CCCCCC;padding-top:10px;padding-left:5px;padding-right:5px;padding-bottom:5px">
                <div class="row">
                  <div class="col-sm-6 pull-left">
                    <button type="button" name="button" class="btn btn-success btn-block btn-sm EdgesSharp" id="AddRoom">Add Room</button>
                  </div>
                  <div class="col-sm-4 pull-right">
                    <button type="button" name="button" class="btn btn-primary btn-block btn-sm EdgesSharp" id="DoneRoom"> Done</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="col-xs-12 col-sm-6 col-md-6 col-lg-2">
          <div class="form">
            <input type="submit" value= "Search" remote = true class="btn btn-primary btn-block EdgesSharp btn-lg" id = "search"> 
          </div>
        </li>
      </ul>
    </div>
  </nav>
</div>
<!-- top navbar end -->

<div class="container-fluid" >
  <div class="col-sm-2 col-sm-offset-5 text-center " >
    <h3 id="DestinationHeading">Destinations</h3>
  </div>
</div>
<div class="container">
  <div class="col-sm-3">
    <div class="box">
      <h3>Manali</h3>
      <!-- <h5 class="PropertiesNumber"><span><strong>124 </strong></span>Properties</h5>
      <div class="pricetag "><h4><strong>Average Price : 1200</strong></h4></div> -->
    </div>
  </div>
  <div class="col-sm-3">
    <div id="box" class="box">
        <h3>Manali</h3>
        <span class="label label-warning PropertiesNumber" style="font-size:14px"><span>525</span> Properties</span>
        <h5 id="pricetag" class="label label-success" style="font-size:14px">Average Price : <span>1200</span></h5>
    </div>
  </div>
  <div class="col-sm-3">
    <div class="box">
      <h3>Manali</h3>
      <!-- <h5 class="PropertiesNumber"><span><strong>124 </strong></span>Properties</h5> -->
      <!-- <div class="pricetag "><h4><strong>Average Price : 1200</strong></h4></div> -->
    </div>
  </div>
</div>

<script type="text/javascript">

  var today = new Date();
  var todayDate = today.getDate();
  var todayMonth= today.getMonth()+1;
  var todayYear = today.getFullYear();
  var maxyear = todayYear +2;
  var maxMonth = todayMonth +7;

  if(maxMonth>12){
    maxMonth=maxMonth-12;
  }


  if(todayMonth<10)
  {
    todayMonth = "0"+todayMonth;
  }


   if(maxMonth<10)
  {
    maxMonth = "0"+maxMonth;
  }

  var todaydatecheck = todayMonth.toString() + "/" + todayDate.toString() + "/" + todayYear.toString();
  var maxdatecheck = maxMonth.toString() + "/" + "01" + "/" + maxyear.toString();


  function CalMonthStr(x)
  {
    if(x==1)
    {
      return "Jan";
    }
    else if(x==2)
    {
      return "Feb";
    }
    else if(x==3)
    {
      return "Mar";
    }
    else if(x==4)
    {
      return "Apr";
    }
    else if(x==5)
    {
      return "May";
    }
    else if(x==6)
    {
      return "Jun";
    }
    else if(x==7)
    {
      return "Jul";
    }
    else if(x==8)
    {
      return "Aug";
    }
    else if(x==9)
    {
      return "Sep";
    }
    else if(x==10)
    {
      return "Oct";
    }
    else if(x==11)
    {
      return "Nov";
    }
    else
    {
      return "Dec";
    }
  }

var checkindatetoserver = '';
var checkoutdatetoserver = '';

$(function() {

  $('input[name="datefilter"]').daterangepicker({
      autoUpdateInput: false,
       "autoApply": true,
       "minDate": todaydatecheck,
       "maxDate": maxdatecheck,
        "maxSpan": {
        "days": 30
        },
      locale: {
          cancelLabel: 'Clear'
      }
  });

  $('input[name="datefilter"]').on('apply.daterangepicker', function(ev, picker) {
      $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
      var x=$('#Calendar').val();
      var firstMonth = x[3]+x[4];
      if(x[3]==0)
      {
        firstMonth = x[4];
      }
      var lastMonth = x[16]+x[17];
      if(x[16]==0)
      {
        lastMonth = x[17];
      }

      var FMonth = "MM";
      FMonth = CalMonthStr(firstMonth);
      var LMonth = "MM";
      LMonth = CalMonthStr(lastMonth);
      $(this).val(" ");

      var firstDate = x[0]+x[1];
      var lastDate = x[13]+x[14];
      var firstYear = x[6]+x[7]+x[8]+x[9];
      var lastYear = x[19]+x[20]+x[21]+x[22];
      checkindatetoserver = firstYear+"-" + firstMonth+ "-" +firstDate;
      checkoutdatetoserver = lastYear+"-" + lastMonth+ "-" +lastDate;
     
      $(this).val(firstDate + "/" + FMonth + "/" +firstYear +" - " +lastDate + "/" + LMonth + "/" +lastYear)
      // $(this).val(picker.startDate.format('DD/'+FMonth+'/YYYY') + ' - ' + picker.endDate.format('DD/'+LMonth+'/YYYY'));

  });

  $('input[name="datefilter"]').on('cancel.daterangepicker', function(ev, picker) {
      $(this).val('');
  });

});




  // Room details

  var AdultChild= [];
  var RoomNumber = 0;

  function PrintRoom(x){
    var RoomNumber=0;
    var Adult=0;
    var Child=0;
    var input="";

    for (var i = 0; i < x.length; i++) {
      Adult=x[i].Adult;
      Child=x[i].TotalChild;
      RoomNumber++;
      input=input+'<div class="col-sm-12" id="RoomNumber"><div class="row" style="border-bottom:solid 1px #CCCCCC">'+
            '<div class="row">'+
             '<div class="col-sm-12">'+
               '<h5>'+
                 'Room '+RoomNumber+
               '</h5>'+
             '</div>'+
           '</div>'+
           '<div class="row">'+
             '<div class="col-sm-8">'+
               '<h6>'+
                 'Adults:'+Adult+' '+
                 'Children:'+Child+' '+
               '</h6>'+
             '</div>'+
             '<div class="col-sm-4">'+
               '<button type="button" class="btn btn-danger btn-block btn-sm EdgesSharp RemoveRoom" value='+RoomNumber+' onclick="RemoveRoom('+i+')">'+
                 'Remove'+
               '</button>'+
             '</div>'+
           '</div>'+
         '</div> </div>'
    }
    document.getElementById('TotalRoom').innerHTML=input;
  }


  function DisableAddRoom(){
    if (AdultChild.length>=5){
      $('#AddRoom').attr("disabled", true);
    }
    else{
      $('#AddRoom').attr("disabled", false);
    }
  }

  function ShowTotal(){
    var room=0;
    var guest=0;
    for (var i = 0; i < AdultChild.length; i++) {
      room++;
      guest=guest+parseInt(AdultChild[i].TotalChild) + parseInt(AdultChild[i].Adult);
    }
    if(AdultChild.length==0){
      document.getElementById('RACShow').value="";
    }
    else{
      document.getElementById('RACShow').value="Room :"+room+ " /Guest :" +guest;
    }
  }

  function AddChildAge(){

    var NoOfChild=$('#NoOfChild').val();
    var ChildAgeArr=[];

    for (var i = 0; i < NoOfChild ; i++) {
      ChildAgeArr[i]=1;
    }

    for (var i = 0; i <NoOfChild ; i++) {
      var y='ChildAge'+i;
      ChildAgeArr[i]=parseInt(document.getElementById(y).value);
    }
    return ChildAgeArr;
  }


  function RemoveRoom(x){
    AdultChild.splice(x,1);
    ShowTotal();
    PrintRoom(AdultChild);
    ShowTotal();
    DisableAddRoom();
  }

  function NoOfChild(){
    var childAgeInp='';
    document.getElementById('ChildAgeCol').innerHTML='';
    var x=$('#NoOfChild').val();
    for (var i = 0; i < x; i++) {
      childAgeInp=childAgeInp + '<div class="col-sm-8">Child '+(i+1)+' age</div>'+
      '<div class="col-sm-4" style="padding-bottom:5px;">'+
        '<select class="form-control control-label input-sm EdgesSharp" id="ChildAge'+i+'">'+
          '<option value="1">1</option>'+
          '<option value="2">2</option>'+
          '<option value="3">3</option>'+
          '<option value="4">4</option>'+
          '<option value="5">5</option>'+
          '<option value="6">6</option>'+
          '<option value="7">7</option>'+
          '<option value="8">8</option>'+
          '<option value="9">9</option>'+
          '<option value="10">10</option>'+
          '<option value="11">11</option>'+
          '<option value="12">12</option>'+
        '</select>'+
      '</div>'
    }
    document.getElementById('ChildAgeCol').innerHTML=childAgeInp;
  }
  var v;
  $(document).ready(function(){
     $('#search').click(function(e){
      var city = document.getElementById('Destination').value;

        $.ajax({
                url : "/room_papa/hotels",
                type : "get",
                data : { data_value: AdultChild,
                         city: city,
                         checkin: checkindatetoserver,
                         checkout: checkoutdatetoserver
                        },
                progress:function(loadTime,status){
                          console.log(loadTime);
                         },
                success: function (result,status,object) {
                          console.log(result);
                          console.log(status);
                          window.location.href = result["url_link"];
                         },
                error:function(result,status) {
                          alert(result.responseText);
                          console.log(status);
                         }
              });
        });
  



    $("#AddRoom").click(function(){

      var Adult = parseInt($("#NoOfAdult").val());
      var TotalChild = parseInt($("#NoOfChild").val());
      var SmallChild = 0;
      var BigChild = 0;
      var arr = AddChildAge();
      for (var i = 0; i < TotalChild; i++) {
        if(arr[i]<=5){
          SmallChild++;
        }
        else {
          BigChild++;
        }
        }
        var AdultChildObj = {Adult,TotalChild,SmallChild,BigChild};
        if((Adult+TotalChild)>6)
        {
          alert("Not more then 6 people in a room !");
        }
        else{
          AdultChild.push(AdultChildObj);
        }
        document.getElementById('NoOfAdult').value = 1;
        document.getElementById('NoOfChild').value = 0;
        NoOfChild();
        PrintRoom(AdultChild);
        ShowTotal();
        DisableAddRoom();
  });

  $('#NoOfChild').click(function(){
    NoOfChild();
  });

  $("#DoneRoom").click(function(){
    $('.drpdwn').toggle(250);
  });

  $('#RACShow').click(function(){
    $('.drpdwn').toggle(250);
  });
});

</script>